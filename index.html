<!DOCTYPE html>
<html>
	<head>
		<title>mga</title>
		<script type="importmap">
		{
			"imports": {
				"three": "https://cdn.jsdelivr.net/npm/three@v0.181.2/build/three.module.js",
				"three/addons/": "https://cdn.jsdelivr.net/npm/three@v0.181.2/examples/jsm/"
			}
		}
		</script>
		<link rel="stylesheet" href="css/index.css"/>
	</head>
	<body>
		<div id="content">
			<noscript>
				<h1 class="loud">
					You need Javascript enabled to run this!
				</h1>
			</noscript>

			<h1>MGA Planner for KSP</h1>
			<h6>By arolaun</h6>
			<br/>

			<div id="outwrapper" class="boxwrapper">
				<div id="orbitview" class="box">
					<h3>Orbital view</h3>
					<hr/>
					<canvas id="system">Solar system view</canvas>
					<p class="centerheader">Time</p>
					<input type="range" min="0" max="9201600" step="any" value="0" class="slider" id="timeslider"/>
					<p id="timelabel">Year 1, Day 1 00:00:00</p>
				</div>
				<div id="trajdetails" class="box">
					<h3>Trajectory Details</h3>
					<hr/>
					<p id="trajdetailsp">
						[Plot a trajectory to see details]
					</p>
					<p id="searchdetails">
					</p>
				</div>
			</div>

			<div class="box" id="inputs">
				<h3>Inputs</h3>
				<hr/>
				<div class="startsearchbox" id="initsettings">
					<p>Departure</p>
					<div class="inputgrid">
						<div class="inputcol">
							<div class="controlgroup">
								<label for="startingbody" class="controllabel">Starting body</label>
								<select name="startingbody" id="startingbody">
								</select>
							</div>
							<div class="controlgroup">
								<label for="initalt" class="controllabel">Initial altitude</label>
								<input type="number" name="initalt" id="initalt" min="0" step="any" value="100" required/>
								<label for="initalt">km ASL</label>
							</div>
							<div class="controlgroup">
								<label for="minvinf" class="controllabel">Min. ejection v<sub>&infin;</sub></label>
								<input type="number" name="minvinf" id="minvinf" min="0" step="any" value="800" required/>
								<label for="minvinf">m/s</label>
							</div>
							<div class="controlgroup">
								<label for="maxvinf" class="controllabel">Max. ejection v<sub>&infin;</sub></label>
								<input type="number" name="maxvinf" id="maxvinf" min="0" step="any" value="2000" required/>
								<label for="maxvinf">m/s</label>
							</div>
						</div>
						<div class="inputcol">
							<div class="controlgroup">
								<label class="controllabel">Earliest departure</label>
								<div class="timegroup">
									<div class="timeinputcontainer">
										<label class="timetypelabel">Year</label>
										<input type="number" min="1" value="1" step="any" id="earliestyear" class="timeinput" required/>
									</div>
								</div>
								<div class="timegroup">
									<div class="timeinputcontainer">
										<label class="timetypelabel">Day</label>
										<input type="number" min="1" max="426" value="1" step="any" id="earliestday" class="timeinput" required/>
									</div>
								</div>
								<div class="timegroup">
									<div class="timeinputcontainer">
										<label class="timetypelabel">Hour</label>
										<input type="number" min="0" max="5" value="0" step="any" id="earliesthour" class="timeinput" required/>
									</div>
								</div>
							</div>
							<div class="controlgroup">
								<label class="controllabel">Latest departure</label>
								<div class="timegroup">
									<div class="timeinputcontainer">
										<label class="timetypelabel">Year</label>
										<input type="number" min="1" value="3" step="any" id="latestyear" class="timeinput"/>
									</div>
								</div>
								<div class="timegroup">
									<div class="timeinputcontainer">
										<label class="timetypelabel">Day</label>
										<input type="number" min="1" max="426" value="1" step="any" id="latestday" class="timeinput"/>
									</div>
								</div>
								<div class="timegroup">
									<div class="timeinputcontainer">
										<label class="timetypelabel">Hour</label>
										<input type="number" min="0" max="5" value="0" step="any" id="latesthour" class="timeinput"/>
									</div>
								</div>
							</div>
							<div class="controlgroup">
								<label for="maxdvdsm" class="controllabel">Max. Δv per DSM</label>
								<input type="number" name="maxdvdsm" id="maxdvdsm" min="0" step="any" value="100" required/>
								<label for="maxdvdsm">m/s</label>
							</div>
						</div>
					</div>
				</div>
				<br/>
				<p>Transfer</p>
				<div class="controlgroup">
					<label for="maxrevs" class="controllabel">Max. revolutions</label>
					<input type="number" name="maxrevs" id="maxrevs" min="0" step="1" value="1" max="20" required/>
				</div>
				<br id="endsettings"/>
				<div class="centered">
					<button id="addbody" class="bodybutton"><svg width="31px" height="31px" xmlns="http://www.w3.org/2000/svg">
						<path d="M 5 13 H 13 V 5 H 17 V 13 H 26 V 17 H 17 V 26 H 13 V 17 H 5 Z" fill="white" stroke="transparent"/>
					</svg></button>
					<button id="subbody" class="bodybutton"><svg width="31px" height="31px" xmlns="http://www.w3.org/2000/svg">
						<path d="M 5 13 H 26 V 17 H 5 Z" fill="white" stroke="transparent"/>
					</svg></button>
				</div>
				<br/>
				<div class="startsearchbox" id="finalsettings">
					<p>Arrival</p>
					<div class="controlgroup">
						<label for="endingbody" class="controllabel">Final body</label>
						<select name="endingbody" id="endingbody">
						</select>
					</div>
					<div class="controlgroup">
						<label for="finalalt" class="controllabel">Final altitude</label>
						<input type="number" name="finalalt" id="finalalt" min="0" step="any" value="100" required/>
						<label for="finalalt">km ASL</label>
					</div>
					<div class="controlgroup">
						<label for="maxduration" class="controllabel">Max. duration</label>
						<input type="number" name="maxduration" id="maxduration" min="0" step="any"/>
						<label for="maxduration">days</label>
					</div>
					<div class="controlgroup">
						<label for="includecapture" class="controllabel">Include insertion in Δv?</label>
						<input type="checkbox" name="includecapture" id="includecapture"/>
					</div>
				</div>
				<p id="errormsg"></p>
				<div class="centered startsearchbox">
					<button id="startsearch">Search trajectories</button>
					<button id="stopsearch">Stop</button>
				</div>
			</div>

			<br/>
			<h2>How To Use</h2>
			<hr/>
			<h3>v<sub>&infin;</sub></h3>
			<hr/>
			<div class="centered">
				<img 
					src="https://arolauntech.github.io/kspmga/imgs/vinf.jpg" 
					alt="Plot of velocity at infinity verses ejection delta-v"
				/>
			</div>
			<p style="margin: 10px;">
				v<sub>&infin;</sub> (velocity at infinity) is a measure of how fast you are going on a hyperbolic orbit when you are an infinite distance from the central body. In this calculator, I use it to mean the velocity at the SOI edge. The image above provides a conversion from ejection Δv to v<sub>&infin;</sub>.
			</p>

			<br/>
			<h2>Acknowledgments</h2>
			<hr/>
			<ul>
				<li>The design of the site is inspired by <a href="https://forum.kerbalspaceprogram.com/topic/33568-winmaclinux-ksp-trajectory-optimization-tool-v1610-major-lvd-improvements/">KSPTOT</a>, <a href="https://nmisyats.github.io/KSP-MGA-Planner/">Krafpy's MGA Planner</a>, and <a href="https://kerbal-transfer-illustrator.netlify.app/Flyby">Astrogoth's Kerbal Transfer Illustrator</a>.</li>
				<li>This project uses <a href="https://threejs.org">THREE.js</a> and code from ESA's <a href="https://esa.github.io/pykep/">pykep</a> library.</li>
			</ul>
			<h4>References:</h4>
			<ul>
				<li>Numerous Wikipedia pages, including those on <a href="https://en.wikipedia.org/wiki/Bairstow%27s_method">Bairstow's method</a>, <a href="https://en.wikipedia.org/wiki/Hyperbolic_functions">hyperbolic trig</a>, and <a href="https://en.wikipedia.org/wiki/Hyperbolic_trajectory">hyperbolic trajectories</a>.</li>
				<li><a href="https://orbital-mechanics.space/intro.html">orbital-mechanics.space</a> for their excellent guide on orbital mechanics</li>
				<li><a href="https://space.stackexchange.com/questions/45961/keplers-equation-written-in-change-in-eccentric-anomaly">This StackExchange post</a></li>
				<li><a href="https://github.com/esa/pykep">pykep's source code</a></li>
				<li><a href="https://alexmoon.github.io/ksp/">alexmoon's Transfer Window Planner</a> and <a href="https://ens-gijs.github.io/ksp/">ens's modification</a></li>
				<li><a href="https://nmisyats.github.io/KSP-MGA-Planner/">Krafpy's MGA Planner</a></li>
				<li><a href="https://forum.kerbalspaceprogram.com/topic/33568-winmaclinux-ksp-trajectory-optimization-tool-v1610-major-lvd-improvements/#comment-454695">Arrowstar's KSPTOT</a></li>
				<li><a href="https://kerbal-transfer-illustrator.netlify.app/">Astrogoth's Kerbal Transfer Illustrator</a></li>
				<li><a href="https://woelen.homescience.net/science/math/exps/accurate_solving/index.html">Wilco Oelen's fast quartic solver</a></li>
				<li><a href="https://dl.acm.org/doi/10.1145/2699468">Flocke, N. (2015). Algorithm 954. ACM Transactions on Mathematical Software, 41(4), 1-24. https://doi.org/10.1145/2699468</a></li>
				<li><a href="https://raw.githubusercontent.com/jorgepiloto/lamberthub/main/art/thesis_jorge.pdf">Garrido, J. M. (2021). Lambert's problem algorithms: a critical review [Unpublished doctoral dissertation]. Universidad Carlos III de Madris. https://raw.githubusercontent.com/jorgepiloto/lamberthub/main/art/thesis_jorge.pdf</a></li>
				<li><a href="https://doi.org/10.2514/1.g007999">Gavira-Aladro, M., & Bombardelli, C. (2024). Lambert-Free solution of multiple-gravity-assist optimization problem. Journal of Guidance, Control, and Dynamics, 47(9), 1822-1838. https://doi.org/10.2514/1.g007999</a></li>
				<li><a href="https://arxiv.org/pdf/1403.2705">Izzo, D. (2014). Revisiting lambert's problem [PDF]. Celestial Mechanics and Dynamical Astronomy, 121(1), 1-15. https://doi.org/10.1007/s10569-014-9587-y</a></li>
				<li><a href="http://hdl.handle.net/2152/31341">Lantukh, D. V. (2015). Preliminary design of spacecraft trajectories for missions to outer planets and small bodies [Unpublished doctoral dissertation]. University of Texas at Austin. http://hdl.handle.net/2152/31341</a></li>
				<li><a href="https://repository.tudelft.nl/record/uuid:02468c77-5c64-4df8-9a24-1ed7ad9d1408">Musegaas, P. (2012). Optimization of space trajectories including multiple gravity assists and deep space maneuvers [Unpublished master's thesis]. Delft University of Technology.</a></li>
				<li><a href="https://www.researchgate.net/profile/Massimiliano-Vasile/publication/253487165_A_GLOBAL_APPROACH_TO_OPTIMAL_SPACE_TRAJECTORY_DESIGN/links/0f3175318b0b4614af000000/A-GLOBAL-APPROACH-TO-OPTIMAL-SPACE-TRAJECTORY-DESIGN.pdf">Vasile, M. (2003, February 9). A global approach to optimal space trajectory design [Paper presentation]. 13th AAS/AIAA space flight mechanics meeting, Ponce, Puerto Rico, United States.</a></li>
			</ul>
		</div>

		<script type="module" src="js/dispose.js"></script>
		<script type="module" src="js/random.js"></script>
		<script type="module" src="js/color.js"></script>
		<script type="module" src="js/kerbaltime.js"></script>
		<script type="module" src="js/vector.js"></script>
		<script type="module" src="js/optimize.js"></script>
		<script type="module" src="js/trajectorycalcs.js"></script>
		<script type="module" src="js/polynomial.js"></script>
		<script type="module" src="js/orbit.js"></script>
		<script type="module" src="js/lambert.js"></script>
		<script type="module" src="js/tree.js"></script>
		<script type="module" src="js/system.js"></script>
		<script type="module" src="js/input.js"></script>
		<script type="module" src="js/renderer.js"></script>
		<script type="module" src="js/mga.js"></script>
		<script type="module" src="js/index.js"></script>
	</body>
</html>